{% extends "base.html" %}

{% block title %}스케줄러 - Data Collector{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="bi bi-clock"></i> 스케줄러 제어</h1>
</div>

<div class="row">
    <div class="col-md-8">
        <!-- Scheduler Status -->
        <div class="card mb-4">
            <div class="card-header {% if config.scheduler.enabled %}bg-success{% else %}bg-secondary{% endif %} text-white">
                <h5 class="mb-0">
                    <i class="bi bi-{% if config.scheduler.enabled %}check-circle{% else %}pause-circle{% endif %}"></i>
                    스케줄러 상태: {% if config.scheduler.enabled %}활성화됨{% else %}비활성화됨{% endif %}
                </h5>
            </div>
            <div class="card-body">
                {% if config.scheduler.enabled %}
                    <div class="alert alert-success" role="alert">
                        <i class="bi bi-info-circle"></i> 
                        스케줄러가 활성화되어 있습니다. <strong>{{ config.scheduler.interval_minutes }}분</strong> 간격으로 자동 수집이 실행됩니다.
                    </div>
                    
                    <h6>현재 설정:</h6>
                    <ul>
                        <li><strong>실행 간격:</strong> {{ config.scheduler.interval_minutes }}분</li>
                        <li><strong>수집 대상:</strong> {{ config.targets|length }}개 URL</li>
                        <li><strong>RSS 피드:</strong> {{ config.rss_feeds|length }}개</li>
                        <li><strong>동시 요청 수:</strong> {{ config.crawler.max_concurrent }}</li>
                    </ul>
                    
                    <div class="alert alert-warning" role="alert">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>주의:</strong> 스케줄러를 사용하려면 CLI에서 <code>python main.py schedule</code> 명령으로 실행해야 합니다.
                    </div>
                {% else %}
                    <div class="alert alert-secondary" role="alert">
                        <i class="bi bi-info-circle"></i> 
                        스케줄러가 비활성화되어 있습니다. 설정에서 활성화할 수 있습니다.
                    </div>
                    
                    <a href="/config" class="btn btn-primary">
                        <i class="bi bi-gear"></i> 설정으로 이동
                    </a>
                {% endif %}
            </div>
        </div>
        
        <!-- Schedule Examples -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-calendar3"></i> 스케줄 예시</h5>
            </div>
            <div class="card-body">
                <h6>CLI 명령어로 스케줄러 실행:</h6>
                
                <div class="bg-dark text-light p-3 rounded mb-3">
                    <code># 설정 파일의 간격으로 실행<br>
                    python main.py schedule<br><br>
                    # 커스텀 간격 지정 (60분마다)<br>
                    python main.py schedule --interval 60<br><br>
                    # 한 번만 실행<br>
                    python main.py schedule --once</code>
                </div>
                
                <h6 class="mt-4">권장 실행 간격:</h6>
                <ul>
                    <li><strong>뉴스 사이트:</strong> 15-30분</li>
                    <li><strong>블로그/포럼:</strong> 60-120분</li>
                    <li><strong>공식 문서:</strong> 360-1440분 (6-24시간)</li>
                    <li><strong>제품 페이지:</strong> 1440분 (24시간)</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Quick Guide -->
        <div class="card mb-3">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0"><i class="bi bi-question-circle"></i> 사용 가이드</h6>
            </div>
            <div class="card-body">
                <h6>스케줄러 활성화 방법:</h6>
                <ol class="small">
                    <li>설정 페이지에서 "스케줄러 활성화" 체크</li>
                    <li>실행 간격 설정 (분 단위)</li>
                    <li>설정 저장</li>
                    <li>CLI에서 <code>python main.py schedule</code> 실행</li>
                </ol>
                
                <hr>
                
                <h6 class="mt-3">스케줄러 중지:</h6>
                <p class="small mb-0">
                    터미널에서 <kbd>Ctrl+C</kbd>를 눌러 스케줄러를 중지할 수 있습니다.
                </p>
            </div>
        </div>
        
        <!-- Tips -->
        <div class="card">
            <div class="card-header bg-warning">
                <h6 class="mb-0"><i class="bi bi-lightbulb"></i> 팁</h6>
            </div>
            <div class="card-body">
                <ul class="small mb-0">
                    <li>너무 짧은 간격은 서버에 부하를 줄 수 있습니다</li>
                    <li>robots.txt를 준수하여 윤리적으로 크롤링하세요</li>
                    <li>로그 파일로 실행 내역을 확인할 수 있습니다</li>
                    <li>중복 검사가 활성화되어 있으면 같은 URL을 다시 수집하지 않습니다</li>
                </ul>
            </div>
        </div>
    </div>
</div>

{% endblock %}
